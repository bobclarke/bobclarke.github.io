---
layout: post
title: Filter Git events within a Jenkinsfile
date: 2017-08-28 08:49:00.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags:
- git
- groovy
- jenkins
meta:
  _publicize_pending: '1'
  restapi_import_id: 5b6f197fa2b75
permalink: "/2017/08/28/filter-git-events-within-a-jenkinsfile/"
---
<p><span style="color:#444444;font-family:verdana;font-size:16px;"> Assuming you're using Git webhooks to trigger your Jenkins builds, let's say you want to trigger a different set of pipeline stages depending on whether the Git event is a push vs. a pull request. I.e for a push you may only wish to run static analysis and unit tests, whereas for a pull request you may want to add Selenium tests.  </span></p>
<p>  <span style="color:#444444;font-family:verdana;font-size:16px;"> The following Jenkinsfile snippet will achieve this </span>    <!-- HTML generated using hilite.me -->
<div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="margin:0;line-height:125%;"><span style="color:#888888;">// Import JSON Slurper</span><br /><span style="color:#008800;font-weight:bold;">import</span> <span style="color:#0e84b5;font-weight:bold;">groovy.json.JsonSlurperClassic</span><br /><br /><span style="color:#888888;">// Get the Git payload</span><br /><span style="color:#333399;font-weight:bold;">def</span> payload <span style="color:#333333;">=</span> <span style="color:#008800;font-weight:bold;">new</span> JsonSlurperClassic<span style="color:#333333;">().</span><span style="color:#0000CC;">parseText</span><span style="color:#333333;">(</span>env<span style="color:#333333;">.</span><span style="color:#0000CC;">payload</span><span style="color:#333333;">)</span><br /><br /><br /><span style="color:#888888;">// Now define a method to filter the event type</span><br /><span style="color:#008800;font-weight:bold;">private</span> String <span style="color:#0066BB;font-weight:bold;">getEventType</span> <span style="color:#333333;">(</span> payload <span style="color:#333333;">){</span><br /><br />   <span style="color:#008800;font-weight:bold;">if</span><span style="color:#333333;">(</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">pull_request</span>  <span style="color:#333333;">&amp;&amp;</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">action</span><span style="color:#333333;">.</span><span style="color:#0000CC;">toLowerCase</span><span style="color:#333333;">().</span><span style="color:#0000CC;">contains</span><span style="color:#333333;">(</span><span style="background-color:#fff0f0;">"opened"</span><span style="color:#333333;">)</span> <span style="color:#333333;">){</span><br />      <span style="color:#008800;font-weight:bold;">return</span> <span style="background-color:#fff0f0;">"pull_req"</span><br />   <span style="color:#333333;">}</span><br /><br />   <span style="color:#008800;font-weight:bold;">else</span> <span style="color:#0066BB;font-weight:bold;">if</span><span style="color:#333333;">(</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">ref</span> <span style="color:#333333;">&amp;&amp;</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">head_commit</span><span style="color:#333333;">){</span><br />      <span style="color:#008800;font-weight:bold;">if</span><span style="color:#333333;">(</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">ref</span><span style="color:#333333;">.</span><span style="color:#0000CC;">split</span><span style="color:#333333;">(</span><span style="background-color:#fff0f0;">&#039;/&#039;</span><span style="color:#333333;">)[</span><span style="color:#0000DD;font-weight:bold;">1</span><span style="color:#333333;">].</span><span style="color:#0000CC;">toLowerCase</span><span style="color:#333333;">().</span><span style="color:#0000CC;">contains</span><span style="color:#333333;">(</span><span style="background-color:#fff0f0;">&#039;head&#039;</span><span style="color:#333333;">)</span> <span style="color:#333333;">){</span><br />         <span style="color:#008800;font-weight:bold;">return</span> <span style="background-color:#fff0f0;">"push"</span><br />      <span style="color:#333333;">}</span><br /><br />      <span style="color:#008800;font-weight:bold;">else</span> <span style="color:#0066BB;font-weight:bold;">if</span><span style="color:#333333;">(</span> payload<span style="color:#333333;">.</span><span style="color:#0000CC;">ref</span><span style="color:#333333;">.</span><span style="color:#0000CC;">split</span><span style="color:#333333;">(</span><span style="background-color:#fff0f0;">&#039;/&#039;</span><span style="color:#333333;">)[</span><span style="color:#0000DD;font-weight:bold;">1</span><span style="color:#333333;">].</span><span style="color:#0000CC;">toLowerCase</span><span style="color:#333333;">().</span><span style="color:#0000CC;">contains</span><span style="color:#333333;">(</span><span style="background-color:#fff0f0;">&#039;tag&#039;</span><span style="color:#333333;">)</span> <span style="color:#333333;">){</span><br />         <span style="color:#008800;font-weight:bold;">return</span> <span style="background-color:#fff0f0;">"tag"</span><br />      <span style="color:#333333;">}</span><br />   <span style="color:#333333;">}</span><br /><span style="color:#333333;">}</span><br /><br /><br /><span style="color:#888888;">// Now decide what action to take </span><br /><span style="color:#333399;font-weight:bold;">def</span> eventType <span style="color:#333333;">=</span> getEventType<span style="color:#333333;">(</span> payload <span style="color:#333333;">)</span><br /><span style="color:#008800;font-weight:bold;">switch</span> <span style="color:#333333;">(</span>eventType<span style="color:#333333;">)</span> <span style="color:#333333;">{</span><br />  <span style="color:#008800;font-weight:bold;">case</span> <span style="background-color:#fff0f0;">"push"</span><span style="color:#333333;">:</span><br />    <span style="color:#333333;">............</span><br />    do something <br />    <span style="color:#333333;">............</span><br />    <span style="color:#008800;font-weight:bold;">break</span><span style="color:#333333;">;</span><br /><br />  <span style="color:#008800;font-weight:bold;">case</span> <span style="background-color:#fff0f0;">"pull_req"</span><span style="color:#333333;">:</span><br />    <span style="color:#333333;">............</span><br />    do something else <br />    <span style="color:#333333;">............</span><br />    <span style="color:#008800;font-weight:bold;">break</span><span style="color:#333333;">;</span><br /><br />  <span style="color:#008800;font-weight:bold;">default</span><span style="color:#333333;">:</span><br />      println <span style="background-color:#fff0f0;">"Git event ignored"</span><span style="color:#333333;">;</span><br />      currentBuild<span style="color:#333333;">.</span><span style="color:#0000CC;">displayName</span> <span style="color:#333333;">=</span> <span style="background-color:#fff0f0;">"Git event ignored"</span><br />      <br />      <span style="color:#888888;">// Tidy up the Jenkins GUI by deleting the ignored build</span><br />      <span style="color:#333399;font-weight:bold;">def</span> buildNumber <span style="color:#333333;">=</span> env<span style="color:#333333;">.</span><span style="color:#0000CC;">BUILD_ID</span><br />      node <span style="color:#333333;">{</span><br />            sh <span style="background-color:#fff0f0;">"curl -X POST http://:@:443/job/execute-pipeline/${buildNumber}/doDelete"</span><br />      <span style="color:#333333;">}</span><br /><br /><br /><br /><br /> <br /></pre>
</div>
<p></p>
